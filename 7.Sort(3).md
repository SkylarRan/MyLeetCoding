# 线性排序：如何根据年龄给100万用户数据排序？

时间复杂度是线性的（O（n）），即为线性排序。
今天学习三种线性排序：桶排序、计数排序、基数排序。之所以能做到时间复杂度是线性的，是因为这三种排序都不是基于比较的排序算法，不涉及元素之间的比较操作。

重点掌握这三种排序的适用场景

## 桶排序（Bucket Sort）

核心思想：将要排序的数据分别装入几个有序的桶中，桶内对数据进行排序，排好序后按照桶的顺序依次取出数据，组成的序列就是有序的了。

![Alt](img/bucketSort.jpg)

### 时间复杂度为什么是O（n）？

假设共有n个数据要排序，被均匀的装入m个有序桶中，每个桶就有k = n / m个数据，每个桶内部使用快速排序，时复为O（k * log k）， m个桶的时复就是O（m * k * log k）， 即O（n * log n/m）。当桶的个数m接近于数据个数n时，  log n/m 就是一个很小的常量， 时复也就接近O（n）。

### 桶排序对排序数据有什么要求？

1. 要排序的数据需要很容易地划分为m个桶，且桶与桶之间有着天然地大小顺序。这样的话，待桶内排序后，整个数据集就有序了。
2. 数据在各个桶中的分布要比较均匀。如果有的桶数据很小，有的桶数据非常多，时复就不是常量级的。当所有数据都划分到一个桶中，时复就退化为O（nlogn）
3. *桶排序比较适用于外部排序中。* 所谓的外部排序就是，数据存储在外部磁盘中，数据量较大，内存有限，不能将全部数据加载进内存中。

### 假设有10GB的订单数据，按照订单金额进行排序，而内存只有几百MB，如何借助桶排序的思想来处理这个问题？

1. 扫描一次数据，找出数据范围，便于划分桶。 假设扫描后发现最小金额为1元，最大金额为10万元。我们划分为100个桶，每个桶中金额范围跨度是1000。如第一个桶存放1-1000订单金额的数据，第二个桶存放1001-2000订单金额的数据... 每个桶对应一个文件，给文件依次命名为00、01、...、99。

2. 理想情况下，所有数据均匀划分到100个文件中，每个文件大概100MB。依次将每个文件放入内存中，使用快排进行排序。每个文件都排好序后，按照文件编号依次读取数据到内存，然后再写入一个新的文件中，那这个新文件中的数据就是排序结果。

3. 实际情况中并不能均匀地划分，可能某个桶内的数据特别多，内存无法一次读取。假如1-1000内的订单数据非常多，我们可以再利用桶排序将这些数据划分到1-100、101-200、...901-1000的桶中进行排序。若某个范围内的数据依然很多，无法一次性读入内存，那就继续划分，直到所有文件都能读入内存为止。

## 计数排序（Counting Sort）

计数排序是桶排序的一种特殊情况。

当n个待排序的数据所处的范围并不大时，最大值为k， 则可以划分为k个桶，每个桶中的数据值是相同的，就省去了桶内排序的时间。例如高考的查分系统，总分700分，可以划分为701个桶，对应0-700分。只涉及一次遍历操作，所以计数排序的时复为O（n）。


### 为什么叫“计数”排序？

假如有8个考生，分数为0-5分，这8个考生的得分依次为：2、5、3、0、2、3、0、3，则共有6个桶，对应着数组C的下标0-5， 故C[6] = {2, 0, 2, 3, 0, 1}, C[i]代表分数i对应的考生个数。

### 如何快速计算每个分数对应的考生的存储位置？

即要求考生排序后的有序数组为R[8]={0, 0, 2, 2, 3, 3, 3, 5}

思路： 对C[6]数据求和， C[i]里存放分数小于等于i的考生个数
C[6] = {2, 2, 4, 7, 7, 8}
C[3] = 7 表示分数<=3 的考生有7个

算法过程：从后往前遍历原始数据数组A，取到第一个元素为3， 从数组C找到C[3]=7, 第7个元素即对应下标为6， 即填入R[6]=3, C[3]-1; 取到第二个元素为0， 从数组C找到C[0]=2, 第2个元素即对应下标为1， 即填入R[1]=2, C[0]-1; 按此步骤依次将数据放入R数组中。

![Alt](img/countingSort.jpg)

> 遍历数组从后往前取，保证了计数是稳定排序算法。 当然从前往后取，结果也是一样的，但不稳定。

> 计数排序只适用于数据范围不大的场景， 如果数据范围k比要排序的数据个数n大很多，就不适用了。 并且计数排序的数据都要是非负整数。


## 基数排序（Radix Sort）

假如要对10万个手机号码进行从小到大排序，要做到时复为O（n）的排序。手机号是11位的，范围太大，不适用于桶排序和计数排序。

特点： 先比较高位，若高位大就不用再比较了，若高位相等则依次比较下一位。

借助稳定排序算法， 想到按时间和金额对订单数据进行排序， 先对第11位数字进行排序，再对第10位数字进行排序。经过11次排序后，就得到最终的排序结果，每次排序中可以使用桶排序，桶内部的数据相同不用再排，故时复为O（n），11次排序的时复依然为O（n）

例如对牛津字典中的单词进行排序，单词又长又短，我们可以在短的单词后面补“0”，任何字母的ASCAII值都大于0， 然后通过基数排序。

> 基数排序对数据有一定的要求，需要将数据分割出“位”来进行排序，而且位之间有递进关系，若高位数据大就不必进行低位的比较了。同时，每一位的数据范围不能太大，可以使用桶排序或计数排序，做到线性排序。

## 如何根据年龄给100万用户数据排序？
设定最小年龄1岁，最大年龄120岁，进行桶排序，划分数据到120个桶，然后依次遍历这120个桶，就将数据排好序了。

